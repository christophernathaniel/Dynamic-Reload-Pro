/*! For license information please see App.js.LICENSE.txt */
(()=>{var e={"./Modules/ClassModule.js":(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var l=r("./src/PageFlow.js");const a=({val:e,parent:t})=>{const r={...e,isValue:1,switchName:"abc"},[a,n]=new l.PageFlow(t,{...r});new l.DatasetHandler(document.querySelector("dataset")).getVar("variable-name2123","new Valuuuu");return{RenderComponent:()=>{const e=(0,l.uuid)();a.node(`<button @ref="${e}_06" @update="${e}_07" @trigger="click">{{ switchName }}</button>`,(e=>{n.switchName=n.isValue=n.isValue+1}),(e=>n.switchName),(e=>(n.isValue=1,1)));a.node(`<span @ref="${e}_07">{{ switchName }}</span>`,null,null,(e=>1)),a.render()}}}},"./Modules/HtmlModule.js":(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var l=r("./src/PageFlow.js");const a=({val:e,parent:t})=>{const r={...e,switchName:"Clear Input",switchValue:""},[a,n]=new l.PageFlow(t,{...r}),s=(new l.DatasetHandler(document.querySelector("dataset")).parseData(),{testCallback:e=>e.value?e.value:" ",clearCallback:e=>" ",defaultCallback:e=>"12"});return{RenderComponent:()=>{const e=(0,l.uuid)();document.querySelectorAll(t+" [html]").forEach((t=>{(0,l.HTMLflow)(a,{item:t},s,e)})),a.render()}}}},"./app.scss":(e,t,r)=>{"use strict";r.r(t)},"./src/PageFlow.js":e=>{class t{constructor(){this.queue=[],this.abortController=new AbortController}async enqueue(e,t){const r={url:e,renderFunction:t};this.queue.push(r);try{await this.processQueue()}catch(e){console.error("Error processing request queue:",e)}}async processQueue(){for(;this.queue.length>0;){const{url:e,renderFunction:t}=this.queue.shift(),{signal:r}=this.abortController;try{const l=await fetch(e,{signal:r});if(!l.ok)throw new Error(`Failed to fetch data from ${e}. Status: ${l.status} ${l.statusText}`);const a=await l.text();if(!a||0===Object.keys(a).length)throw new Error(`No valid data received from ${e}`);t(a)}catch(t){console.error(`Error while fetching or rendering data from ${e}:`,t)}}}cancelAll(){this.abortController.abort(),this.abortController=new AbortController,this.queue=[]}}e.exports={PageFlow:class{constructor(e,{...t}){return this._pageFlow=[],this._elemFlow=[],this._elemFlowRef=[],this._app=e,this._variables=t,[this,t]}_findRef(e){const t=String(e);let r=this._elemFlow.find((e=>String(e.ref)===t));return r?.selector??null}_findObjectByRef=e=>this._elemFlow.find((t=>t["@ref"]===e));_findRefObjectByRef=e=>this._elemFlowRef.find((t=>t["@ref"]===e));_getValue(e){const t=/{{\s*(.*?)\s*}}/;let r=e;const l=e.match(t);let a;if(l){const n=l[1].trim();a=this._variables[n],r=void 0!==a?e.replace(t,a):null}return{result:r,value:a}}_eventListener=e=>{const t=e.match(/@ref="([^"]*)"/),r=t?t[1]:null,l=e.match(/@trigger="([^"]*)"/),a=l?l[1]:null,n=e.match(/@render="([^"]*)"/);n&&n[1];"run"===a&&callback(this._findObjectByRef(r)?.selector),"click"===a&&this._findObjectByRef(r)?.selector.addEventListener("click",(()=>{this._renderEventListener(r)})),"input"===a&&this._findObjectByRef(r)?.selector.addEventListener("keyup",(()=>{this._renderEventListener(r)}))};_renderEventListener=e=>{let t=this._findRefObjectByRef(e)?.callback,r=this._findRefObjectByRef(e)?.postcallback,l=(this._findRefObjectByRef(e),this._findRefObjectByRef(e).string),a=null,n=null;if(t){let r=t(this._findObjectByRef(e)?.selector);r&&(a=r)}if(this._htmlChange(l,a),r){let t=r(this._findObjectByRef(e)?.selector);if(!t)return!1;n=t}this._updateAttribute(l,n)};_htmlChange=(e,t)=>{const r=e.match(/@ref="([^"]*)"/),l=r?r[1]:null;t||(t=this._getFullString(e).value),void 0!==t&&this._getFullString(e).value!==this._findRefObjectByRef(l)?.value&&this._findRefObjectByRef(l)?.value&&("input"===this._findObjectByRef(l)?.selector?.tagName.toLowerCase()?(this._findRefObjectByRef(l).value=t,this._findObjectByRef(l).selector.value=t):(this._findRefObjectByRef(l).value=t,this._findObjectByRef(l).selector.innerHTML=t))};_getFullString=e=>this._getValue(e)?this._getValue(e):null;_updateAttribute=(e,t=null)=>{const r=e.match(/@update="([^"]*)"/),l=r?r[1]:null;if(null==l)return;l.split(",").forEach((e=>{this._htmlChangeByRef(e,t)}))};_htmlChangeByRef=(e,t)=>{t||(t=this._getFullString().value),this._findObjectByRef(e)&&(null!==this._findRefObjectByRef(e)?.value?"input"===this._findObjectByRef(e)?.selector?.tagName.toLowerCase()?(this._findRefObjectByRef(e).value=t,this._findObjectByRef(e).selector.value=t):(this._findRefObjectByRef(e).value=t,this._findObjectByRef(e).selector.innerHTML=t):console.log("refValue does not exist"))};node(e,t=null,r=null,l=null){let a=this._getFullString(e);this._htmlChange(e);(()=>{const t=this._elemFlowRef.find((t=>t.string===e));if(t)this._findObjectByRef(t["@ref"])})();const n=(()=>{const t=e.match(/(?:class|data-\w+|@ref|@trigger|@update)="([^"]*)"/g)||[],r={};return t.forEach((e=>{const[t,l]=e.split("=");r[t]=l.replace(/"/g,"")})),r})(),s=((()=>{const t=/<div[^>]*>([^<]*)<\/div>/.exec(e);t&&t[1].trim()})(),this._findObjectByRef(n["@ref"]));if(s){const{selector:e}=s,t={};for(const[e,r]of Object.entries(n))e.startsWith("@")?t[e.slice(1)]=r:t[e]=r;return Object.entries(t).forEach((([t,r])=>{"ref"!==t&&"trigger"!==t&&"update"!==t&&e.setAttribute(t,r)})),e}const i=document.createElement("template");i.innerHTML=a.result.trim();const c=i.content.firstChild;t&&(c.getAttribute("@trigger"),c.addEventListener(c.getAttribute("@action"),(()=>{t?.(null)}))),this._elemFlow.push({"@ref":c.getAttribute("@ref"),selector:c,update:null}),this._elemFlowRef.push({"@ref":c.getAttribute("@ref"),"@trigger":c.getAttribute("@trigger"),"@update":c.getAttribute("@update")??null,"@render":c.getAttribute("@render")??null,"@initial":c.getAttribute("@initial")??null,"@parent":c.getAttribute("@parent")??null,index:this._elemFlow.length-1,class:c.classList,id:c.getAttribute("id"),data:c.dataset,string:e??"",value:a.value??"",update:c.getAttribute("@load")??null,callback:t??null,postcallback:r??null,defaultcallback:l??null});let u=document.querySelector(this._app);return this._findObjectByRef(c.getAttribute("@parent"))?.selector?u=this._findObjectByRef(c.getAttribute("@parent"))?.selector:c.getAttribute("@parent")&&(u=document.querySelector(c.getAttribute("@parent"))),u.appendChild(c),this._eventListener(e),c??null}render=()=>{this._elemFlowRef.forEach((e=>{if(e["@update"]&&!1!==e["@load"]&&"click"!==e["@trigger"]&&this._renderEventListener(e["@ref"]),e["@trigger"],e["@render"]&&this._renderEventListener(e["@render"]),e.defaultcallback){console.log("run");let t=e.defaultcallback();t&&(console.log(e["@ref"]),console.log("has VaLu"),console.log(t),this._htmlChangeByRef(e["@ref"],t))}}))}},HTMLflow:(e,t,r,l)=>{let a=t.item,n={"@trigger":a.getAttribute("@trigger")??null,"@update":a.getAttribute("@update").split(",").map((e=>l+e)).join(",")??null,"@ref":a.getAttribute("@ref").split(",").map((e=>l+e)).join(",")??null,"@parent":a.getAttribute("@parent")??null,class:a.getAttribute("class")??null,id:a.getAttribute("id")??null,style:a.getAttribute("style")??null,type:a.tagName.toLowerCase(),value:a.value??null};const s=()=>{};let i={callback:a.getAttribute("callback")?r[a.getAttribute("callback")]:s,postcallback:a.getAttribute("postcallback")?r[a.getAttribute("postcallback")]:s,defaultcallback:a.getAttribute("defaultcallback")?r[a.getAttribute("defaultcallback")]:s};a.remove(),n=Object.fromEntries(Object.entries(n).filter((([e,t])=>null!==t))),"input"===n.type?e.node(`<${n.type} ${Object.entries(n).map((([e,t])=>`${e}="${t}"`)).join(" ")} value="${a.value}">`,i.callback,i.postcallback,i.defaultcallback):e.node(`<${n.type} ${Object.entries(n).map((([e,t])=>`${e}="${t}"`)).join(" ")}>${a.innerHTML}</${n.type}>`,i.callback,i.postcallback,i.defaultcallback)},DynamicPage:class{constructor(e,r){this.cache=[],this.url=window.location.protocol+"//"+window.location.host,this.source=e.source,this.target=e.target,this.requestQueue=new t,this.renderList=r}upsertPage(e,t){const r=this.cache.findIndex((t=>t.url===e));r>-1?this.cache[r].data=t:this.cache.push({url:e,data:t})}getPage(e){return this.cache.find((t=>t.url===e))}exists(e){return this.cache.some((t=>t.url===e&&null!==t.data&&void 0!==t.data&&""!==t.data))}removePage(e){this.cache=this.cache.filter((t=>t.url!==e))}clear(){this.cache=[]}getAllPages(){return this.cache}runCallbacks=(e,t)=>{e.forEach((e=>{e(t)}))};_renderPage(e){}_makeRequest(e){this.requestQueue.enqueue(e,this._processRequest.bind(this))}_processRequest(e){document.querySelector(this.target).innerHTML="";let t=(new DOMParser).parseFromString(e,"text/html").querySelector(this.source);return t?document.querySelector(this.target).appendChild(t.cloneNode(!0)):console.error("Source element not found"),this.runCallbacks(this.renderList),!0}},uuid:()=>([1e3]+-100+-400+-800+-1e12).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))),DatasetHandler:class{constructor(e){this.datasetElement=e,this.dataMap=this.parseData()}parseData(){const{datasetElement:e}=this;if(!e||!e.dataset.set)return null;const{set:t}=e.dataset,r=Array.from(e.querySelectorAll("data"));if(!r.length)return null;const l=r.reduce(((e,t)=>{const{collection:r,value:l}=t.dataset;return e[r]=l,e}),{});return new Map([[t,l]])}getVar(e,t){if(!this.dataMap)return t;const r=this.dataMap.get(this.datasetElement.dataset.set);return r&&void 0!==r[e]?r[e]:t}}}}},t={};function r(l){var a=t[l];if(void 0!==a)return a.exports;var n=t[l]={exports:{}};return e[l](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var l in t)r.o(t,l)&&!r.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var l={};(()=>{"use strict";r.r(l);r("./app.scss");var e=r("./src/PageFlow.js"),t=r("./Modules/HtmlModule.js"),a=r("./Modules/ClassModule.js");const n={counter:1};let s=[()=>{document.querySelectorAll("a").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),i._makeRequest(e.href)}))}))}];s=[...s,(0,t.default)({val:n,parent:".myParent2"}).RenderComponent],s=[...s,(0,a.default)({val:n,parent:".myParent"}).RenderComponent];const i=new e.DynamicPage({source:"DynamicPage",target:"App"},s);i._makeRequest("index.html")})()})();
//# sourceMappingURL=App.js.map