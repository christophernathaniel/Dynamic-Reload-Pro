/*! For license information please see PageFlow.js.LICENSE.txt */
(()=>{var e={"./src/PageFlow.js":e=>{class t{constructor(){this.queue=[],this.abortController=new AbortController}async enqueue(e,t){const r={url:e,renderFunction:t};this.queue.push(r);try{await this.processQueue()}catch(e){console.error("Error processing request queue:",e)}}async processQueue(){for(;this.queue.length>0;){const{url:e,renderFunction:t}=this.queue.shift(),{signal:r}=this.abortController;try{const l=await fetch(e,{signal:r});if(!l.ok)throw new Error(`Failed to fetch data from ${e}. Status: ${l.status} ${l.statusText}`);const i=await l.text();if(!i||0===Object.keys(i).length)throw new Error(`No valid data received from ${e}`);t(i)}catch(t){console.error(`Error while fetching or rendering data from ${e}:`,t)}}}cancelAll(){this.abortController.abort(),this.abortController=new AbortController,this.queue=[]}}e.exports={PageFlow:class{constructor(e,{...t}){return this._pageFlow=[],this._elemFlow=[],this._elemFlowRef=[],this._app=e,this._variables=t,[this,t]}_findRef(e){const t=String(e);let r=this._elemFlow.find((e=>String(e.ref)===t));return r?.selector??null}_findObjectByRef=e=>this._elemFlow.find((t=>t["@ref"]===e));_findRefObjectByRef=e=>this._elemFlowRef.find((t=>t["@ref"]===e));_getValue(e){const t=/{{\s*(.*?)\s*}}/;let r=e;const l=e.match(t);let i;if(l){const n=l[1].trim();i=this._variables[n],r=void 0!==i?e.replace(t,i):null}return{result:r,value:i}}_eventListener=e=>{const t=e.match(/@ref="([^"]*)"/),r=t?t[1]:null,l=e.match(/@trigger="([^"]*)"/),i=l?l[1]:null,n=e.match(/@render="([^"]*)"/);n&&n[1];"run"===i&&callback(this._findObjectByRef(r)?.selector),"click"===i&&this._findObjectByRef(r)?.selector.addEventListener("click",(()=>{this._renderEventListener(r)})),"input"===i&&this._findObjectByRef(r)?.selector.addEventListener("keyup",(()=>{this._renderEventListener(r)}))};_renderEventListener=e=>{let t=this._findRefObjectByRef(e)?.callback,r=this._findRefObjectByRef(e)?.postcallback,l=(this._findRefObjectByRef(e),this._findRefObjectByRef(e).string),i=null,n=null;if(t){let r=t(this._findObjectByRef(e)?.selector);r&&(i=r)}if(this._htmlChange(l,i),r){let t=r(this._findObjectByRef(e)?.selector);if(!t)return!1;n=t}this._updateAttribute(l,n)};_htmlChange=(e,t)=>{const r=e.match(/@ref="([^"]*)"/),l=r?r[1]:null;t||(t=this._getFullString(e).value),void 0!==t&&this._getFullString(e).value!==this._findRefObjectByRef(l)?.value&&this._findRefObjectByRef(l)?.value&&("input"===this._findObjectByRef(l)?.selector?.tagName.toLowerCase()?(this._findRefObjectByRef(l).value=t,this._findObjectByRef(l).selector.value=t):(this._findRefObjectByRef(l).value=t,this._findObjectByRef(l).selector.innerHTML=t))};_getFullString=e=>this._getValue(e)?this._getValue(e):null;_updateAttribute=(e,t=null)=>{const r=e.match(/@update="([^"]*)"/),l=r?r[1]:null;if(null==l)return;l.split(",").forEach((e=>{this._htmlChangeByRef(e,t)}))};_htmlChangeByRef=(e,t)=>{t||(t=this._getFullString().value),this._findObjectByRef(e)&&(null!==this._findRefObjectByRef(e)?.value?"input"===this._findObjectByRef(e)?.selector?.tagName.toLowerCase()?(this._findRefObjectByRef(e).value=t,this._findObjectByRef(e).selector.value=t):(this._findRefObjectByRef(e).value=t,this._findObjectByRef(e).selector.innerHTML=t):console.log("refValue does not exist"))};node(e,t=null,r=null,l=null){let i=this._getFullString(e);this._htmlChange(e);(()=>{const t=this._elemFlowRef.find((t=>t.string===e));if(t)this._findObjectByRef(t["@ref"])})();const n=(()=>{const t=e.match(/(?:class|data-\w+|@ref|@trigger|@update)="([^"]*)"/g)||[],r={};return t.forEach((e=>{const[t,l]=e.split("=");r[t]=l.replace(/"/g,"")})),r})(),s=((()=>{const t=/<div[^>]*>([^<]*)<\/div>/.exec(e);t&&t[1].trim()})(),this._findObjectByRef(n["@ref"]));if(s){const{selector:e}=s,t={};for(const[e,r]of Object.entries(n))e.startsWith("@")?t[e.slice(1)]=r:t[e]=r;return Object.entries(t).forEach((([t,r])=>{"ref"!==t&&"trigger"!==t&&"update"!==t&&e.setAttribute(t,r)})),e}const a=document.createElement("template");a.innerHTML=i.result.trim();const c=a.content.firstChild;t&&(c.getAttribute("@trigger"),c.addEventListener(c.getAttribute("@action"),(()=>{t?.(null)}))),this._elemFlow.push({"@ref":c.getAttribute("@ref"),selector:c,update:null}),this._elemFlowRef.push({"@ref":c.getAttribute("@ref"),"@trigger":c.getAttribute("@trigger"),"@update":c.getAttribute("@update")??null,"@render":c.getAttribute("@render")??null,"@initial":c.getAttribute("@initial")??null,"@parent":c.getAttribute("@parent")??null,index:this._elemFlow.length-1,class:c.classList,id:c.getAttribute("id"),data:c.dataset,string:e??"",value:i.value??"",update:c.getAttribute("@load")??null,callback:t??null,postcallback:r??null,defaultcallback:l??null});let u=document.querySelector(this._app);return this._findObjectByRef(c.getAttribute("@parent"))?.selector?u=this._findObjectByRef(c.getAttribute("@parent"))?.selector:c.getAttribute("@parent")&&(u=document.querySelector(c.getAttribute("@parent"))),u.appendChild(c),this._eventListener(e),c??null}render=()=>{this._elemFlowRef.forEach((e=>{if(e["@update"]&&!1!==e["@load"]&&"click"!==e["@trigger"]&&this._renderEventListener(e["@ref"]),e["@trigger"],e["@render"]&&this._renderEventListener(e["@render"]),e.defaultcallback){console.log("run");let t=e.defaultcallback();t&&(console.log(e["@ref"]),console.log("has VaLu"),console.log(t),this._htmlChangeByRef(e["@ref"],t))}}))}},HTMLflow:(e,t,r,l)=>{let i=t.item,n={"@trigger":i.getAttribute("@trigger")??null,"@update":i.getAttribute("@update").split(",").map((e=>l+e)).join(",")??null,"@ref":i.getAttribute("@ref").split(",").map((e=>l+e)).join(",")??null,"@parent":i.getAttribute("@parent")??null,class:i.getAttribute("class")??null,id:i.getAttribute("id")??null,style:i.getAttribute("style")??null,type:i.tagName.toLowerCase(),value:i.value??null};const s=()=>{};let a={callback:i.getAttribute("callback")?r[i.getAttribute("callback")]:s,postcallback:i.getAttribute("postcallback")?r[i.getAttribute("postcallback")]:s,defaultcallback:i.getAttribute("defaultcallback")?r[i.getAttribute("defaultcallback")]:s};i.remove(),n=Object.fromEntries(Object.entries(n).filter((([e,t])=>null!==t))),"input"===n.type?e.node(`<${n.type} ${Object.entries(n).map((([e,t])=>`${e}="${t}"`)).join(" ")} value="${i.value}">`,a.callback,a.postcallback,a.defaultcallback):e.node(`<${n.type} ${Object.entries(n).map((([e,t])=>`${e}="${t}"`)).join(" ")}>${i.innerHTML}</${n.type}>`,a.callback,a.postcallback,a.defaultcallback)},DynamicPage:class{constructor(e,r){this.cache=[],this.url=window.location.protocol+"//"+window.location.host,this.source=e.source,this.target=e.target,this.requestQueue=new t,this.renderList=r}upsertPage(e,t){const r=this.cache.findIndex((t=>t.url===e));r>-1?this.cache[r].data=t:this.cache.push({url:e,data:t})}getPage(e){return this.cache.find((t=>t.url===e))}exists(e){return this.cache.some((t=>t.url===e&&null!==t.data&&void 0!==t.data&&""!==t.data))}removePage(e){this.cache=this.cache.filter((t=>t.url!==e))}clear(){this.cache=[]}getAllPages(){return this.cache}runCallbacks=(e,t)=>{e.forEach((e=>{e(t)}))};_renderPage(e){}_makeRequest(e){this.requestQueue.enqueue(e,this._processRequest.bind(this))}_processRequest(e){document.querySelector(this.target).innerHTML="";let t=(new DOMParser).parseFromString(e,"text/html").querySelector(this.source);return t?document.querySelector(this.target).appendChild(t.cloneNode(!0)):console.error("Source element not found"),this.runCallbacks(this.renderList),!0}},uuid:()=>([1e3]+-100+-400+-800+-1e12).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))),DatasetHandler:class{constructor(e){this.datasetElement=e,this.dataMap=this.parseData()}parseData(){const{datasetElement:e}=this;if(!e||!e.dataset.set)return null;const{set:t}=e.dataset,r=Array.from(e.querySelectorAll("data"));if(!r.length)return null;const l=r.reduce(((e,t)=>{const{collection:r,value:l}=t.dataset;return e[r]=l,e}),{});return new Map([[t,l]])}getVar(e,t){if(!this.dataMap)return t;const r=this.dataMap.get(this.datasetElement.dataset.set);return r&&void 0!==r[e]?r[e]:t}}}}},t={};(function r(l){var i=t[l];if(void 0!==i)return i.exports;var n=t[l]={exports:{}};return e[l](n,n.exports,r),n.exports})("./src/PageFlow.js")})();
//# sourceMappingURL=PageFlow.js.map